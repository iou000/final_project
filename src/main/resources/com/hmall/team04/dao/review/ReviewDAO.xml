<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
	PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.hmall.team04.dao.review.ReviewDAO">

	<!-- index.jsp와 관련된 prd_board 표시 기본형 -->
	<resultMap id="ReviewResult" type="reviewDTO">
		<result property="content" column="content" jdbcType="CLOB" javaType="java.lang.String" />
	</resultMap>
	
	<select id="getReviewListBasic" parameterType="String" resultType="reviewDTO" resultMap="ReviewResult">
		select
		review_id, prd_board_id, user_id, content, star, ins_dt, file_yn
		from review_t rt
		WHERE rt.prd_board_id=#{prd_board_id}
	</select>
	
	<!-- insert review -->
	<insert id="enrollReview" parameterType="reviewDTO">
		insert into review_t(review_id,prd_board_id,user_id,content,star,file_yn)
		values(review_t_review_id_seq.nextval,#{prd_board_id},#{user_id},#{content},#{star},#{file_yn})
	</insert>
	
 	<!-- 댓글 페이징 -->
  	<select id="getReviewList" resultType="reviewDTO">
  	
  		<![CDATA[
		select * from(  		
			select rownum as rn, review_id, prd_board_id, user_id, content, star, ins_dt, file_yn
			from review_t
			where rownum <= #{pageNum} * #{amount}  and prd_board_id = #{prd_board_id}	
			order by ins_dt desc  	
  			)
  		where rn > (#{pageNum} -1) * #{amount}
  		]]>	
  		
  	</select>
  	
  	<select id="getReviewTotal" resultType="int">
  	
  		select count(*)
  		from review_t
  		where prd_board_id = #{prd_board_id}
  	
  	</select>
</mapper>